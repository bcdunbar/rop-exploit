#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void vuln_func(char *contents) {
    char out[1024]; // 1024 max size
    strcpy(out, contents); // unsanitized input leading to buffer overflow vuln
    printf("%s", out);
} 

void fileReader()
{
    char fname[80];
    char *content = NULL; // NULL and no max size
    FILE *fp;
    long fsize;

    printf("File name?\n");
    gets(fname); // use unsafe gets insteads of safe fgets
    printf("File: '%s'.\n", fname);

    fp = fopen(fname, "r"); // read mode
    if (fp == NULL)
    {
        perror("Error\n");
        exit(EXIT_FAILURE);
    }

    fseek(fp, 0, SEEK_END);
    fsize = ftell(fp);
    content = malloc(sizeof(char) * (fsize + 1));
    fseek(fp, 0, SEEK_SET);

    printf("Length: '%ld'.\n", fsize);
    printf("Content:\n");

    fread(content, sizeof(char), fsize, fp);

    vuln_func(content);

    fclose(fp);
}

int main(int argc, char *argv[])
{
    fileReader();
    printf("\nPress any key to exit\n");
    getchar();

    return 0;
}